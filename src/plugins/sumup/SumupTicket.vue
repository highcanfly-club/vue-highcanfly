<template>
    <div class="w-96 border border-dashed p-2">
        <div id="header">
            <div class="logo sumup_logo">
                <svg encoding="UTF-8" height="72.8" width="250.64000000000001" viewBox="0 0 250.64000000000001 72.8"
                    version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                    <g class="path" transform="scale(0.52, 0.52)" xmlns="http://www.w3.org/2000/svg">
                        <path fill="#1D384C"
                            d="M10,0 L130,0 C135.522847,0 140,4.4771525 140,10 L140,130 C140,135.522847 135.522847,140 130,140 L10,140 C4.4771525,140 0,135.522847 0,130 L0,10 C0,4.4771525 4.4771525,0 10,0 Z M86.464271,60.555657 L43.0481716,103.970174 C42.3005846,104.773446 42.3173473,106.030905 43.0993479,106.812905 C43.164482,106.878039 43.2329145,106.937865 43.3041079,106.992381 C56.166153,118.172772 75.675411,117.645456 87.910434,105.410434 C100.210562,93.110306 100.678052,73.458319 89.312905,60.599348 C88.526116,59.8202064 87.266519,59.8043681 86.464271,60.555657 Z M53.5357289,79.444343 L53.5365201,79.445134 L96.951828,36.029826 L96.95094,36.0289379 C97.699415,35.2265538 97.682653,33.9690953 96.900652,33.1870947 C96.835518,33.1219606 96.767085,33.0621354 96.695892,33.0076189 C83.833847,21.8272282 64.324589,22.354544 52.0895663,34.5895663 C39.7894383,46.8896942 39.3219478,66.541681 50.6870947,79.400652 L50.6909185,79.396828 C51.4738837,80.179794 52.7334805,80.195632 53.5357289,79.444343 Z M185.664395,83.811465 C187.164446,83.811465 188.704097,84.654131 189.998227,86.15338 C192.42492,89.133903 196.104559,89.586956 198.068722,89.586956 C204.494495,89.586956 207.856805,85.933462 207.856805,82.337591 C207.856805,77.413225 202.774267,75.425505 196.890224,73.136455 C189.545202,70.255846 180.392305,66.687465 180.392305,55.5250404 C180.392305,44.6829772 189.628098,39 198.762516,39 C205.387872,39 212.37755,42.6445065 215.762036,47.8813039 C216.334917,48.7324289 216.634822,49.7833832 216.634822,50.91945 C216.634822,53.8915149 214.041809,56.399426 210.976763,56.399426 C209.359496,56.399426 207.889013,55.5250404 206.618643,53.8243765 C204.701999,51.1467691 201.98385,49.7331615 198.762516,49.7331615 C193.619786,49.7331615 191.319814,52.6444318 191.319814,55.5250404 C191.319814,59.1277837 195.069149,60.784041 201.184456,63.193095 C209.026327,66.291507 218.784314,70.131085 218.784314,82.337591 C218.784314,94.025493 208.115525,100.333333 198.068722,100.333333 C192.200519,100.333333 184.478505,97.658898 181.07237,92.526773 C180.362737,91.505952 180,90.420635 180,89.275581 C180,86.421934 182.699141,83.811465 185.664395,83.811465 Z M425.199452,39 C435.977492,39 444.196078,47.1555612 444.196078,57.8755786 L444.196078,80.351725 C444.196078,91.053297 435.977492,100.31559 425.199452,100.31559 L424.887945,100.31559 C421.798878,100.31559 418.356379,99.450231 416.29364,97.625705 L416.29364,125.610742 C416.29364,128.582054 413.863672,131 410.867473,131 C407.870212,131 405.440775,128.582054 405.440775,125.610742 L405.440775,82.842927 C405.375502,82.206819 405.440775,81.551739 405.440775,80.905091 L405.440775,58.4126071 C405.440775,47.702076 414.109375,39 424.887945,39 L425.199452,39 Z M433.631902,80.905091 L433.631902,58.4126071 C433.631902,53.7875212 429.854547,50.0457128 425.199452,50.0457128 L424.887945,50.0457128 C420.232851,50.0457128 416.451251,53.7875212 416.451251,58.4126071 L416.451251,80.905091 C416.451251,86.771825 420.232851,89.272513 424.887945,89.272513 L425.199452,89.272513 C429.854547,89.272513 433.631902,86.771825 433.631902,80.905091 Z M394.559362,44.1525202 L394.588235,44.1525202 L394.588235,81.30966 C394.588235,91.790204 385.953637,100.333333 375.351939,100.333333 L375.042357,100.333333 C364.431035,100.333333 355.803922,91.790204 355.803922,81.30966 L355.803922,44.1525202 L355.846162,44.1525202 C355.981971,41.2804937 358.354895,39 361.284959,39 C364.215557,39 366.593828,41.2804937 366.729638,44.1525202 L366.738193,44.1525202 L366.738193,44.2867912 C366.738193,44.3190374 366.752629,44.363442 366.752629,44.4041463 C366.752629,44.4374497 366.738193,44.4792112 366.738193,44.5135719 L366.738193,81.30966 C366.738193,85.838401 370.450498,89.508125 375.042357,89.508125 L375.351939,89.508125 C379.924549,89.508125 383.645944,85.838401 383.645944,81.30966 L383.645944,44.1525202 L383.679094,44.1525202 C383.814904,41.2804937 386.178738,39 389.117892,39 C392.053302,39 394.424088,41.2804937 394.559362,44.1525202 Z M266.565239,44.1525202 L266.588235,44.1525202 L266.588235,81.30966 C266.588235,91.790204 257.959992,100.333333 247.343947,100.333333 L247.044466,100.333333 C236.438048,100.333333 227.803922,91.790204 227.803922,81.30966 L227.803922,44.1525202 L227.846704,44.1525202 C227.982005,41.2804937 230.355922,39 233.296178,39 C236.217716,39 238.593237,41.2804937 238.733886,44.1525202 L238.748325,44.1525202 L238.748325,44.2867912 C238.748325,44.3190374 238.753138,44.363442 238.753138,44.4041463 C238.753138,44.4374497 238.748325,44.4792112 238.748325,44.5135719 L238.748325,81.30966 C238.748325,85.838401 242.465625,89.508125 247.044466,89.508125 L247.343947,89.508125 C251.931879,89.508125 255.651854,85.838401 255.651854,81.30966 L255.651854,44.1525202 L255.679662,44.1525202 C255.815498,41.2804937 258.18995,39 261.120044,39 C264.056022,39 266.429404,41.2804937 266.565239,44.1525202 Z M325.131964,39 C335.618362,39 344.156863,47.5227159 344.156863,58.0061162 L344.156863,95.148166 L344.110346,95.148166 C343.976081,98.01179 341.634376,100.301633 338.732882,100.301633 C335.826631,100.301633 333.484926,98.01179 333.355419,95.148166 L333.336389,95.148166 L333.336389,95.013967 C333.336389,94.972227 333.327403,94.937885 333.327403,94.896146 C333.327403,94.854407 333.336389,94.820064 333.336389,94.785194 L333.336389,58.0061162 C333.336389,53.4776803 329.667366,49.80252 325.131964,49.80252 L324.83119,49.80252 C320.412081,49.80252 316.815476,53.3017418 316.644738,57.6780146 C316.649495,57.7958353 316.65901,57.913656 316.65901,58.0388735 L316.65901,95.174055 L316.62148,95.174055 C316.487215,98.046132 314.14181,100.333333 311.241902,100.333333 C309.414526,100.333333 307.812335,99.424582 306.836536,98.046132 C306.248731,97.227728 305.882939,96.226516 305.834836,95.148166 L305.806292,95.148166 L305.806292,58.0061162 C305.806292,57.8972773 305.825322,57.7958353 305.825322,57.6869964 C305.636082,53.3181205 302.048464,49.8352773 297.630412,49.8352773 L297.333338,49.8352773 C292.798994,49.8352773 289.128913,53.5035692 289.128913,58.0388735 L289.128913,95.174055 L289.096668,95.174055 C288.966632,98.046132 286.620699,100.333333 283.719205,100.333333 C280.816654,100.333333 278.47072,98.046132 278.341213,95.174055 L278.313725,95.174055 L278.313725,58.0388735 C278.313725,47.5544166 286.84694,39.0348707 297.333338,39.0348707 L297.630412,39.0348707 C302.956072,39.0348707 307.762118,41.2301397 311.219172,44.7568354 C314.677812,41.2132327 319.494958,39 324.83119,39 L325.131964,39 Z M469.452047,39 C475.423226,39 480.27451,43.864831 480.27451,49.8224633 C480.27451,55.79822 475.423226,60.647059 469.452047,60.647059 C463.480867,60.647059 458.627451,55.79822 458.627451,49.8224633 C458.627451,43.864831 463.480867,39 469.452047,39 Z M469.452047,58.024336 C473.971628,58.024336 477.65022,54.3397302 477.65022,49.8224633 C477.65022,45.3094609 473.971628,41.6504427 469.452047,41.6504427 C464.937266,41.6504427 461.251741,45.3094609 461.251741,49.8224633 C461.251741,54.3397302 464.937266,58.024336 469.452047,58.024336 Z M465.843137,45.531875 C465.843137,44.8155013 466.385709,44.4117647 466.960318,44.4117647 L469.65199,44.4117647 C471.637803,44.4117647 472.936357,45.6307387 472.936357,47.4703284 C472.936357,48.9211922 472.04499,49.9678017 470.647222,50.2302305 L472.592212,52.3306962 C472.895535,52.6619672 473.058824,52.9249137 473.058824,53.2960408 C473.058824,53.6179949 472.773586,54.3333333 471.913739,54.3333333 C471.33913,54.3333333 471.136053,54.1278417 470.855466,53.7831128 L468.11367,50.3120131 L468.08215,50.3120131 L468.08215,53.1397222 C468.08215,53.9301143 467.611921,54.3333333 466.960318,54.3333333 C466.318017,54.3333333 465.843137,53.9301143 465.843137,53.1397222 L465.843137,45.531875 Z M468.08215,48.6577282 L469.55226,48.6577282 C470.285507,48.6577282 470.706129,48.1685857 470.706129,47.5531462 C470.706129,46.8797342 470.185777,46.484797 469.55226,46.484797 L468.08215,46.484797 L468.08215,48.6577282 Z">
                        </path>
                    </g>
                </svg>
            </div>
            <div id="merchant_data">
                <div id="business_name">
                    {{ props.checkout.merchant_name }}
                </div>
                <div id="address">
                    <div>{{ receipt?.merchant_data.merchant_profile.address?.address_line1 }}</div>
                    <div></div>
                    <div>{{ receipt?.merchant_data.merchant_profile.address?.post_code }} {{
                            receipt?.merchant_data.merchant_profile.address?.city
                    }} </div>
                    <div>{{ receipt?.merchant_data.merchant_profile.address?.country_native_name }}</div>
                    <div></div>
                    <div></div>
                    <div></div>
                </div>
            </div>
        </div>

        <div id="content" >
            <div class="mt-2 rounded border">
                <table id="receipt_data_table">
                    <tbody>
                        <tr id="merchant_code">
                            <td>Identifiant marchand:</td>
                            <td>{{ props.checkout.merchant_code }}</td>
                        </tr>

                        <tr id="transaction_code">
                            <td>Identifiant de la transaction:</td>
                            <td>{{ props.checkout.transactions[0].transaction_code }}</td>
                        </tr>

                        <tr id="sale_receipt_no">
                            <td>N° de reçu:</td>
                            <td>{{ receipt?.transaction_data.receipt_no }}</td>
                        </tr>

                    </tbody>
                </table>

                <div id="card_data">

                    <div id="card_type">
                        {{ receipt?.transaction_data.card.type }}
                    </div>

                    <div id="masked_pan">
                        **** **** **** {{ receipt?.transaction_data.card.last_4_digits }}
                    </div>

                    <div id="entry_mode">
                        Saisie manuelle
                    </div>

                </div>

            </div>

            <div class="mt-2 rounded border">
                <div id="failed_header" class="tx-headers">
                    {{ SumupPaymentStatusFR[receipt?.transaction_data.status] }}
                </div>

                <div id="sale_timestamp" class="tx-time">
                    {{ new Date(props.checkout.transactions[0].timestamp).toLocaleString() }}
                </div>

                <div class="spacer-large"></div>

                <table class="amounts_table" width="100%">

                    <tbody>
                        <tr id="sale_amount" class="amount large">
                            <td class="amount_name">Total:</td>
                            <td class="amount_value large">
                                {{ props.checkout.amount }} {{ props.checkout.currency }}
                            </td>
                        </tr>

                    </tbody>
                </table>

            </div>

            <div class="white-box">
                <div id="reminder">
                    Copie client: VEUILLEZ CONSERVER UNE COPIE POUR VOS DOSSIERS
                </div>

            </div>

            <div id="footer" class="text-xs">
                <div class="logo sumup_logo">
                    <svg encoding="UTF-8" height="30.8" width="106.04" viewBox="0 0 106.04 30.8" version="1.1"
                        xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g class="path" transform="scale(0.22, 0.22)" xmlns="http://www.w3.org/2000/svg">
                            <path fill="#1D384C"
                                d="M10,0 L130,0 C135.522847,0 140,4.4771525 140,10 L140,130 C140,135.522847 135.522847,140 130,140 L10,140 C4.4771525,140 0,135.522847 0,130 L0,10 C0,4.4771525 4.4771525,0 10,0 Z M86.464271,60.555657 L43.0481716,103.970174 C42.3005846,104.773446 42.3173473,106.030905 43.0993479,106.812905 C43.164482,106.878039 43.2329145,106.937865 43.3041079,106.992381 C56.166153,118.172772 75.675411,117.645456 87.910434,105.410434 C100.210562,93.110306 100.678052,73.458319 89.312905,60.599348 C88.526116,59.8202064 87.266519,59.8043681 86.464271,60.555657 Z M53.5357289,79.444343 L53.5365201,79.445134 L96.951828,36.029826 L96.95094,36.0289379 C97.699415,35.2265538 97.682653,33.9690953 96.900652,33.1870947 C96.835518,33.1219606 96.767085,33.0621354 96.695892,33.0076189 C83.833847,21.8272282 64.324589,22.354544 52.0895663,34.5895663 C39.7894383,46.8896942 39.3219478,66.541681 50.6870947,79.400652 L50.6909185,79.396828 C51.4738837,80.179794 52.7334805,80.195632 53.5357289,79.444343 Z M185.664395,83.811465 C187.164446,83.811465 188.704097,84.654131 189.998227,86.15338 C192.42492,89.133903 196.104559,89.586956 198.068722,89.586956 C204.494495,89.586956 207.856805,85.933462 207.856805,82.337591 C207.856805,77.413225 202.774267,75.425505 196.890224,73.136455 C189.545202,70.255846 180.392305,66.687465 180.392305,55.5250404 C180.392305,44.6829772 189.628098,39 198.762516,39 C205.387872,39 212.37755,42.6445065 215.762036,47.8813039 C216.334917,48.7324289 216.634822,49.7833832 216.634822,50.91945 C216.634822,53.8915149 214.041809,56.399426 210.976763,56.399426 C209.359496,56.399426 207.889013,55.5250404 206.618643,53.8243765 C204.701999,51.1467691 201.98385,49.7331615 198.762516,49.7331615 C193.619786,49.7331615 191.319814,52.6444318 191.319814,55.5250404 C191.319814,59.1277837 195.069149,60.784041 201.184456,63.193095 C209.026327,66.291507 218.784314,70.131085 218.784314,82.337591 C218.784314,94.025493 208.115525,100.333333 198.068722,100.333333 C192.200519,100.333333 184.478505,97.658898 181.07237,92.526773 C180.362737,91.505952 180,90.420635 180,89.275581 C180,86.421934 182.699141,83.811465 185.664395,83.811465 Z M425.199452,39 C435.977492,39 444.196078,47.1555612 444.196078,57.8755786 L444.196078,80.351725 C444.196078,91.053297 435.977492,100.31559 425.199452,100.31559 L424.887945,100.31559 C421.798878,100.31559 418.356379,99.450231 416.29364,97.625705 L416.29364,125.610742 C416.29364,128.582054 413.863672,131 410.867473,131 C407.870212,131 405.440775,128.582054 405.440775,125.610742 L405.440775,82.842927 C405.375502,82.206819 405.440775,81.551739 405.440775,80.905091 L405.440775,58.4126071 C405.440775,47.702076 414.109375,39 424.887945,39 L425.199452,39 Z M433.631902,80.905091 L433.631902,58.4126071 C433.631902,53.7875212 429.854547,50.0457128 425.199452,50.0457128 L424.887945,50.0457128 C420.232851,50.0457128 416.451251,53.7875212 416.451251,58.4126071 L416.451251,80.905091 C416.451251,86.771825 420.232851,89.272513 424.887945,89.272513 L425.199452,89.272513 C429.854547,89.272513 433.631902,86.771825 433.631902,80.905091 Z M394.559362,44.1525202 L394.588235,44.1525202 L394.588235,81.30966 C394.588235,91.790204 385.953637,100.333333 375.351939,100.333333 L375.042357,100.333333 C364.431035,100.333333 355.803922,91.790204 355.803922,81.30966 L355.803922,44.1525202 L355.846162,44.1525202 C355.981971,41.2804937 358.354895,39 361.284959,39 C364.215557,39 366.593828,41.2804937 366.729638,44.1525202 L366.738193,44.1525202 L366.738193,44.2867912 C366.738193,44.3190374 366.752629,44.363442 366.752629,44.4041463 C366.752629,44.4374497 366.738193,44.4792112 366.738193,44.5135719 L366.738193,81.30966 C366.738193,85.838401 370.450498,89.508125 375.042357,89.508125 L375.351939,89.508125 C379.924549,89.508125 383.645944,85.838401 383.645944,81.30966 L383.645944,44.1525202 L383.679094,44.1525202 C383.814904,41.2804937 386.178738,39 389.117892,39 C392.053302,39 394.424088,41.2804937 394.559362,44.1525202 Z M266.565239,44.1525202 L266.588235,44.1525202 L266.588235,81.30966 C266.588235,91.790204 257.959992,100.333333 247.343947,100.333333 L247.044466,100.333333 C236.438048,100.333333 227.803922,91.790204 227.803922,81.30966 L227.803922,44.1525202 L227.846704,44.1525202 C227.982005,41.2804937 230.355922,39 233.296178,39 C236.217716,39 238.593237,41.2804937 238.733886,44.1525202 L238.748325,44.1525202 L238.748325,44.2867912 C238.748325,44.3190374 238.753138,44.363442 238.753138,44.4041463 C238.753138,44.4374497 238.748325,44.4792112 238.748325,44.5135719 L238.748325,81.30966 C238.748325,85.838401 242.465625,89.508125 247.044466,89.508125 L247.343947,89.508125 C251.931879,89.508125 255.651854,85.838401 255.651854,81.30966 L255.651854,44.1525202 L255.679662,44.1525202 C255.815498,41.2804937 258.18995,39 261.120044,39 C264.056022,39 266.429404,41.2804937 266.565239,44.1525202 Z M325.131964,39 C335.618362,39 344.156863,47.5227159 344.156863,58.0061162 L344.156863,95.148166 L344.110346,95.148166 C343.976081,98.01179 341.634376,100.301633 338.732882,100.301633 C335.826631,100.301633 333.484926,98.01179 333.355419,95.148166 L333.336389,95.148166 L333.336389,95.013967 C333.336389,94.972227 333.327403,94.937885 333.327403,94.896146 C333.327403,94.854407 333.336389,94.820064 333.336389,94.785194 L333.336389,58.0061162 C333.336389,53.4776803 329.667366,49.80252 325.131964,49.80252 L324.83119,49.80252 C320.412081,49.80252 316.815476,53.3017418 316.644738,57.6780146 C316.649495,57.7958353 316.65901,57.913656 316.65901,58.0388735 L316.65901,95.174055 L316.62148,95.174055 C316.487215,98.046132 314.14181,100.333333 311.241902,100.333333 C309.414526,100.333333 307.812335,99.424582 306.836536,98.046132 C306.248731,97.227728 305.882939,96.226516 305.834836,95.148166 L305.806292,95.148166 L305.806292,58.0061162 C305.806292,57.8972773 305.825322,57.7958353 305.825322,57.6869964 C305.636082,53.3181205 302.048464,49.8352773 297.630412,49.8352773 L297.333338,49.8352773 C292.798994,49.8352773 289.128913,53.5035692 289.128913,58.0388735 L289.128913,95.174055 L289.096668,95.174055 C288.966632,98.046132 286.620699,100.333333 283.719205,100.333333 C280.816654,100.333333 278.47072,98.046132 278.341213,95.174055 L278.313725,95.174055 L278.313725,58.0388735 C278.313725,47.5544166 286.84694,39.0348707 297.333338,39.0348707 L297.630412,39.0348707 C302.956072,39.0348707 307.762118,41.2301397 311.219172,44.7568354 C314.677812,41.2132327 319.494958,39 324.83119,39 L325.131964,39 Z M469.452047,39 C475.423226,39 480.27451,43.864831 480.27451,49.8224633 C480.27451,55.79822 475.423226,60.647059 469.452047,60.647059 C463.480867,60.647059 458.627451,55.79822 458.627451,49.8224633 C458.627451,43.864831 463.480867,39 469.452047,39 Z M469.452047,58.024336 C473.971628,58.024336 477.65022,54.3397302 477.65022,49.8224633 C477.65022,45.3094609 473.971628,41.6504427 469.452047,41.6504427 C464.937266,41.6504427 461.251741,45.3094609 461.251741,49.8224633 C461.251741,54.3397302 464.937266,58.024336 469.452047,58.024336 Z M465.843137,45.531875 C465.843137,44.8155013 466.385709,44.4117647 466.960318,44.4117647 L469.65199,44.4117647 C471.637803,44.4117647 472.936357,45.6307387 472.936357,47.4703284 C472.936357,48.9211922 472.04499,49.9678017 470.647222,50.2302305 L472.592212,52.3306962 C472.895535,52.6619672 473.058824,52.9249137 473.058824,53.2960408 C473.058824,53.6179949 472.773586,54.3333333 471.913739,54.3333333 C471.33913,54.3333333 471.136053,54.1278417 470.855466,53.7831128 L468.11367,50.3120131 L468.08215,50.3120131 L468.08215,53.1397222 C468.08215,53.9301143 467.611921,54.3333333 466.960318,54.3333333 C466.318017,54.3333333 465.843137,53.9301143 465.843137,53.1397222 L465.843137,45.531875 Z M468.08215,48.6577282 L469.55226,48.6577282 C470.285507,48.6577282 470.706129,48.1685857 470.706129,47.5531462 C470.706129,46.8797342 470.185777,46.484797 469.55226,46.484797 L468.08215,46.484797 L468.08215,48.6577282 Z">
                            </path>
                        </g>
                    </svg>
                </div>

                <div id="footer_text">
                    <div id="sumup_footer_text">
                        Ce paiement a été effectué avec SumUp.
                        Acceptez les paiements dès aujourd'hui avec notre terminal intuitif, disponible à petit prix.
                        Rendez-vous sur <a href="https://sumup.fr">sumup.fr</a> pour plus d'informations.
                    </div>

                </div>

            </div>
        </div>
    </div>
</template>
<script setup lang="ts">
import { SumupCheckout, SumupReceipt, SumupPaymentStatusFR } from './api';
import { onMounted, ref } from 'vue';

const props = defineProps<{ checkout: SumupCheckout, securedToken: string }>()
const receipt = ref<SumupReceipt>()

onMounted(() => {
    retrieveTicket(props.checkout.checkout_reference, props.securedToken, props.checkout.transactions[0].transaction_code).then(_receipt => {
        receipt.value = _receipt
    })
})

function retrieveTicket(
    checkout_reference: string, accessToken: string, transactionId: string
) {
    return new Promise<SumupReceipt>((resolve) => {
        const searchParams = new URLSearchParams();
        searchParams.append("checkout_reference", checkout_reference)
        searchParams.append("access_token", accessToken)
        searchParams.append("transaction_id", transactionId)
        fetch(`/sumup/ticket?${searchParams.toString()}`).then(value => {
            value.json().then((data) => {
                resolve(data as SumupReceipt)
            })
        })
    })
}
</script>